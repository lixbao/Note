## HTTP原理

### 1、HTTP协议解析

> Hyper Text Transfer Protocol（超文本传输协议）是万维网协会（World Wide Web Consortium）和Internet工作小组IETF（Internet Engineering Task Force）合作的结果，（他们）最终发布了一系列的RFC
>
> RFC 1945	HTTP/1.0
>
> RFC 2616	HTTP 1.1

![image-20211222154618831](https://raw.githubusercontent.com/lixbao/PicGo/main/imgimage-20211222154618831.png)

*HTTP工作流程*

1. 首先客户机与服务器需要建立连接。单击某个超级链接，经过TCP三次握手后，HTTP的工作开始。
2. 建立TCP连接后，客户机发送一个HTTP请求给服务器，请求方式的格式为：统一资源标识符（URL）、协议版本号，后边是MIME(多用途互联网邮件扩展类型)信息包括请求修饰符、客户机信息和可能的内容。
3. 服务器接到请求后，给予相应的响应信息，其格式为一个状态行，包括信息的协议版本号、一个成功或错误的代码，后边是MIME信息包括服务器信息、实体信息和可能的内容。
4. 客户端接收服务器所返回的信息通过浏览器显示在用户的显示屏上，然后客户机与服务器断开连接。



### 2、HTTP请求与响应状态码

HTTP响应消息格式如下

![image-20211222160430181](https://raw.githubusercontent.com/lixbao/PicGo/main/imgimage-20211222160430181.png)



**http状态返回代码 1xx（临时响应）**

表示临时响应并需要请求者继续执行操作的状态代码。

+ **100  （继续）** 请求者应当继续提出请求。 服务器返回此代码表示已收到请求的第一部分，正在等待其余部分。 

+ **101  （切换协议）** 请求者已要求服务器切换协议，服务器已确认并准备切换。



**http状态返回代码 2xx （成功）**

表示成功处理了请求的状态代码。

- **200  （成功）** 服务器已成功处理了请求。 通常，这表示服务器提供了请求的网页。
- **201  （已创建）** 请求成功并且服务器创建了新的资源。
- **202  （已接受）** 服务器已接受请求，但尚未处理。
- **203  （非授权信息）** 服务器已成功处理了请求，但返回的信息可能来自另一来源。
- **204  （无内容）** 服务器成功处理了请求，但没有返回任何内容。
- **205  （重置内容）** 服务器成功处理了请求，但没有返回任何内容。
- **206  （部分内容）** 服务器成功处理了部分 GET 请求。



**http状态返回代码 3xx （重定向）**

表示要完成请求，需要进一步操作。 通常用来重定向。

- **300  （多种选择）** 针对请求，服务器可执行多种操作。 服务器可根据请求者 (user agent) 选择一项操作，或提供操作列表供请求者选择。
- **301  （永久移动）** 请求的网页已永久移动到新位置。 服务器返回此响应（对 GET 或 HEAD 请求的响应）时，会自动将请求者转到新位置。
- **302  （临时移动）** 服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求。
- **303  （查看其他位置）** 请求者应当对不同的位置使用单独的 GET 请求来检索响应时，服务器返回此代码。
- **304  （未修改）** 自从上次请求后，请求的网页未修改过。 服务器返回此响应时，不会返回网页内容。
- **305  （使用代理）** 请求者只能使用代理访问请求的网页。 如果服务器返回此响应，还表示请求者应使用代理。
- **307  （临时重定向）** 服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求。



**http状态返回代码 4xx（请求错误）**

 这些状态代码表示请求可能出错，妨碍了服务器的处理。

- **400  （错误请求）** 服务器不理解请求的语法。
- **401  （未授权）** 请求要求身份验证。 对于需要登录的网页，服务器可能返回此响应。
- **403  （禁止）** 服务器拒绝请求。
- **404  （未找到）** 服务器找不到请求的网页。
- **405  （方法禁用）** 禁用请求中指定的方法。
- **406  （不接受）** 无法使用请求的内容特性响应请求的网页。
- **407  （需要代理授权）** 此状态代码与 401（未授权）类似，但指定请求者应当授权使用代理。
- **408  （请求超时）** 服务器等候请求时发生超时。
- **409  （冲突）** 服务器在完成请求时发生冲突。 服务器必须在响应中包含有关冲突的信息。
- **410  （已删除）** 如果请求的资源已永久删除，服务器就会返回此响应。
- **411  （需要有效长度）** 服务器不接受不含有效内容长度标头字段的请求。
- **412  （未满足前提条件）** 服务器未满足请求者在请求中设置的其中一个前提条件。
- **413  （请求实体过大）** 服务器无法处理请求，因为请求实体过大，超出服务器的处理能力。
- **414  （请求的 URI 过长）** 请求的 URI（通常为网址）过长，服务器无法处理。
- **415  （不支持的媒体类型）** 请求的格式不受请求页面的支持。
- **416  （请求范围不符合要求）** 如果页面无法提供请求的范围，则服务器会返回此状态代码。
- **417  （未满足期望值）** 服务器未满足"期望"请求标头字段的要求。



**http状态返回代码 5xx（服务器错误）**

 这些状态代码表示服务器在尝试处理请求时发生内部错误。

- **500  （服务器内部错误）** 服务器遇到错误，无法完成请求。
- **501  （尚未实施）** 服务器不具备完成请求的功能。 例如，服务器无法识别请求方法时可能会返回此代码。
- **502  （错误网关）** 服务器作为网关或代理，从上游服务器收到无效响应。
- **503  （服务不可用）** 服务器目前无法使用（由于超载或停机维护）。 通常，这只是暂时状态。
- **504  （网关超时）** 服务器作为网关或代理，但是没有及时从上游服务器收到请求。
- **505  （HTTP 版本不受支持）** 服务器不支持请求中所用的 HTTP 协议版本。 



### 3、HTTP响应头

**Location**头域

+ 作用：Location响应报头域用于重定向接受者到一个新的位置。
+ 例如：客户端所请求的页面已不存在原先的位置，为了让客户端重定向到这个页面新的位置，服务器端可以发回Location响应报头后使用重定向语句，让客户端去访问新的域名所对应的服务器上的资源;

**Server**头域

+ 作用：Server 响应报头域包含了服务器用来处理请求的软件信息及其版本。它和 User-Agent 请求报头域是相对应的，前者发送服务器端软件的信息，后者发送客户端软件(浏览器)和操作系统的信息。

**Content-Type**头域

+ 作用：用于定义网络文件的类型和网页的编码，决定浏览器将以什么形式、什么编码读取这个文件。

**Set-Cookie**头域

+ 设置和页面关联的Cookie。



## WEB 安全简介

### 1、基础术语

- **后门**：指绕过安全控制而获取对程序或系统访问权的方法
- **webshell**：webshell就是以asp、php、jsp或者cgi等网页文件形式存在的一种代码执行环境
- **0day**：0day是一个统称，所有的破解都可以叫0day
- **exploit**：Exploit 的英文意思就是利用，它在黑客眼里就是漏洞利用。有漏洞不一定就有Exploit（利用)，有Exploit就肯定有漏洞。
- **提权**：提高自己在服务器中的权限，主要针对网站入侵过程中，当入侵某一网站时，通过各种漏洞提升WEBSHELL权限以夺得该服务器权限。
- **跳板**：跳板通俗讲就是一条通往目标主机的主机链
- **拖库**：指网站遭到入侵后，黑客窃取其数据库文件
- **社会工程学**：所有社会工程学攻击都建立在使人决断产生认知偏差的基础上。有时候这些偏差被称为“人类硬件漏洞”，足以产生众多攻击方式
- **apt攻击**：即高级可持续威胁攻击,也称为定向威胁攻击，指某组织对特定对象展开的持续有效的攻击活动

### 2、主要攻击手段

基于应用层

- 弱口令
- 配置缺陷
- 应用漏洞
- 注入

基于网络层和主机层

- Ddos攻击
- 远程溢出攻击
- ARP欺骗
- 木马及蠕虫病毒

### 3、渗透测试

> 通过模拟恶意攻击者的技术与方法，挫败目标系统安全控制措施，取得访问控制权，并发现具备业务影响后果安全隐患的一种安全测试与评估方式，这种通过实际的攻击进行安全测试与评估的方法就是渗透测试。

黑盒测试：设计为模拟一个对客户组织一无所知的攻击者所进行的渗透攻击。

白盒测试：渗透测试者在拥有客户组织所有知识的情况下所进行的渗透测试。

灰盒测试：介于黑盒白盒两者之间。



渗透测试过程：

- 前期交互阶段
- 情报收集阶段
- 威胁建模阶段
- 漏洞分析阶段
- 渗透攻击阶段
- 后渗透攻击阶段
- 报告阶段



### 4、OWASP TOP 10

> OWASP十大WEB应用安全威胁项目
>
> 开放式Web应用程序安全项目（OWASP，Open Web Application Security Project）是一个组织，它提供有关计算机和互联网应用程序的公正、实际、有成本效益的信息。 
>
> 针对目前最普遍的web应用层，为安全测试人员和开发者提供了如何识别与避免这些安全威胁的指南。

常见漏洞攻击详细内容已写入博客

[OWASP TOP 10等常见漏洞 - 不破爱花灬 - 博客园 (cnblogs.com)](https://www.cnblogs.com/illusory---/p/14815463.html)

## 黑客攻击入侵流程

> 为了入侵内网erp/oa系统，黑客必须首先拿到内网中的一台主机权限，将其作为跳板机横向移动，继续入侵erp系统。

**入侵思路1：拿下内网服务器**

1. 锁定目标为公网上某一对外开放web服务的服务器。
2. 漏洞扫描/挖掘，发现该网站存在的漏洞。
3. 利用其中高危漏洞getshell，篡改页面。
4. 至此黑客已经拿下目标内网的一台主机控制权限。
5. 下一步将用其作为跳板机发起对内网的攻击。

**入侵思路2：拿下内网PC**

1. 前期信息收集，拿到内部员工的邮箱账号。

2. 给员工邮箱发送一封钓鱼邮件，里面含有恶意网站/恶意程序。

3. 员工点击邮件打开恶意网站，自动下载恶意软件触发恶意代码。

4. 主机权限反弹到黑客服务器,黑客拿到员工主机权限。

5. 下一步就是利用该跳板机横向移动，内网渗透。获取内网中更有价值的信息。

   

**横向移动**

1. 利用跳板机做端口转发,扫描内网，发现网络拓扑。
2. 使用嗅探，扫描等手段。发现其他内网主机的漏洞。(例如数据服务器，获取更有价值的数据)
3. 利用主机漏洞，获取主机权限。（例如MS17-010 smb，ms-08067等）
4. 上传XOR.DDOS病毒。所有主机沦为肉鸡。
5. 上传勒索软件，加密数据。

